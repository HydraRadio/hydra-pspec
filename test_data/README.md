# Test data

Provided is a set of test data which you can use to test your installation of `hydra_pspec`.  This test data is comprised of:

1. `vis-eor-fgs.uvh5`: a `pyuvdata.UVData` compatible file containing simulated mock epoch of reionization (EoR) and foreground (FG) visibilities.  The data were simulated at Ntimes=203 times spanning ~2 hours of LST, Nfreqs=120 frequencies spanning 100 - 120 MHz, and have shape `(Ntimes, Nfreqs)`.
2. `eor-cov.npy`: frequency-frequency covariance matrix of the EoR visibilities with shape `(Nfreqs, Nfreqs)`.  This matrix was generated by:
    a. Calculating the time-averaged delay power spectrum of the EoR visibilities
    b. Forming a diagonal matrix where the diagonal entries are the aforementioned delay power spectrum bandpowers
    c. Fourier transforming this delay-delay EoR covariance matrix to obtain the frequency-frequency covariance
3. `fgmodes.npy`: Matrix of FG model basis vectors with shape `(Nfreqs, Nfreqs)` where the vectors form the columns of the matrix.
4. `noise.npy`: complex noise drawn from a normal distribution with a variance chosen such that the signal-to-noise-ratio (SNR) in the visibilities of the EoR is SNR_{vis}=10.  This corresponds to an SNR in the delay power spectrum of SNR_{DPS}=100.  The noise has an identical shape to the visibilities, `(Ntimes, Nfreqs)`.
5. `noise-cov.npy`: noise covariance matrix with shape `(Nfreqs, Nfreqs)` generated as the identity matrix times the variance of the noise.
6. `config.yaml`: configuration file used by `hydra_pspec` containing all of the required analysis parameters (including _relative_ paths to the test data files).
7. `vis-eor.uvh5`: a `pyuvdata.UVData` compatible file containing the simulated mock EoR visibilities only from `vis-eor-fgs.uvh5`.

## Installing hydra-pspec

`hydra_pspec` relies on the following dependencies
- numpy
- scipy
- multiprocess
- pyuvdata
- astropy
- jsonargparse

You can install these dependencies manually using your preferred package manager or create an environment using the provided `environment.yml` file in the root directory of the hydra-pspec repo via
```
conda env create -f environment.yaml
```

To install hydra-pspec, for the time being please do so from the root directory of the hydra-pspec repo via
```
pip install -e .
```

## Running hydra-pspec

To run `hydra_pspec` using the test data, simply run
```
python ../run-hydra-pspec.py --config config.yaml
```
from within this `test_data/` directory.  This will create an output directory in this directory containing the outputs of `hydra_pspec`.

## Checking the results

To generate a simple plot comparing the input (true) and recovered EoR delay power spectra, from the `test_data/` directory simply run
```
python plot-test-data-results.py
```
